<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Recommendations - Auto_Mind</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="/" class="logo">Auto_Mind</a>
            <ul class="nav-links" id="navLinks">
                <li><a href="/">Home</a></li>
                <li><a href="/predict_page">Predict</a></li>
                <li><a href="/chatbot">ChatBot</a></li>
                <li><a href="/services">Services</a></li>
                <li><a href="/contact">Contact</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/connect">Connect</a></li>
            </ul>
            <button class="mobile-toggle" id="mobileToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <div class="recommendations-container">
        <div class="predict-header">
            <h1><i class="fas fa-search"></i> Car Recommendations</h1>
            <p>Find your perfect car within your budget</p>
        </div>

        <div class="price-filter">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; flex-wrap:wrap; gap:1rem;">
                <h3 style="margin:0;"><i class="fas fa-filter"></i> Filter by Price Range</h3>
                <button class="btn btn-success" onclick="toggleAddCarForm()" style="background-color:#28a745;">
                    <i class="fas fa-plus"></i> Add Custom Car
                </button>
            </div>
            <div class="price-range-inputs">
                <div class="form-group">
                    <label class="form-label" for="min_price">Min Price (₹)</label>
                    <input type="number" class="form-control" id="min_price" value="0" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label" for="max_price">Max Price (₹)</label>
                    <input type="number" class="form-control" id="max_price" value="5000000" min="0">
                </div>
                <div class="form-group" style="display:flex; align-items:flex-end;">
                    <button class="btn btn-primary" onclick="searchCars()" style="width:100%;">
                        <i class="fas fa-search"></i> Search Cars
                    </button>
                </div>
            </div>
            <div style="display:flex; gap:1rem; flex-wrap:wrap;">
                <button class="btn btn-secondary" onclick="setPriceRange(0, 500000)">Under ₹5 Lakh</button>
                <button class="btn btn-secondary" onclick="setPriceRange(500000, 1000000)">₹5-10 Lakh</button>
                <button class="btn btn-secondary" onclick="setPriceRange(1000000, 2000000)">₹10-20 Lakh</button>
                <button class="btn btn-secondary" onclick="setPriceRange(2000000, 5000000)">₹20-50 Lakh</button>
                <button class="btn btn-secondary" onclick="setPriceRange(5000000, 10000000)">Above ₹50 Lakh</button>
            </div>
        </div>

        <!-- Add Custom Car Form -->
        <div id="addCarForm" style="display:none; background:white; padding:2rem; border-radius:10px; margin:2rem 0; box-shadow:0 2px 10px rgba(0,0,0,0.1);">
            <h3 style="margin-top:0;"><i class="fas fa-car"></i> Add New Car Recommendation</h3>
            <p style="color:#666; margin-bottom:1.5rem;">Add a car that's not in our dataset to help others discover it!</p>
            <form id="customCarForm" onsubmit="addCustomCar(event)">
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:1rem;">
                    <div class="form-group">
                        <label class="form-label" for="custom_company">Company *</label>
                        <input type="text" class="form-control" id="custom_company" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="custom_model">Model *</label>
                        <input type="text" class="form-control" id="custom_model" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="custom_year">Year *</label>
                        <input type="number" class="form-control" id="custom_year" min="1900" max="2100" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="custom_fuel_type">Fuel Type *</label>
                        <select class="form-control" id="custom_fuel_type" required>
                            <option value="">Select...</option>
                            {% for fuel in fuel_types %}
                            <option value="{{ fuel }}">{{ fuel }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="custom_price">Price (₹) *</label>
                        <input type="number" class="form-control" id="custom_price" min="0" step="1000" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="custom_kms_driven">Kilometers Driven</label>
                        <input type="number" class="form-control" id="custom_kms_driven" min="0" value="0">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="custom_image_url">Image URL (optional)</label>
                    <input type="url" class="form-control" id="custom_image_url" placeholder="Leave empty for auto-generated image">
                </div>
                <div class="form-group">
                    <label class="form-label" for="custom_description">Description (optional)</label>
                    <textarea class="form-control" id="custom_description" rows="3" placeholder="Additional details about the car..."></textarea>
                </div>
                <div style="display:flex; gap:1rem; margin-top:1rem;">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Car
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="toggleAddCarForm()">
                        Cancel
                    </button>
                </div>
                <div id="addCarMessage" style="margin-top:1rem;"></div>
            </form>
        </div>

        <div id="loadingSection" class="loading" style="display:none;">
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
        </div>

        <div id="resultsSection" class="car-grid"></div>

        <div id="noResults" style="display:none; text-align:center; padding:3rem; color:var(--text-muted);">
            <i class="fas fa-car" style="font-size:4rem; margin-bottom:1rem;"></i>
            <h3>No cars found in this price range</h3>
            <p>Try adjusting your price range</p>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-social">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-linkedin-in"></i></a>
                <a href="#"><i class="fab fa-github"></i></a>
            </div>
            <p>&copy; <span id="year"></span> Auto_Mind. The Intelligence Behind Car Price Prediction.</p>
        </div>
    </footer>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        const mobileToggle = document.getElementById('mobileToggle');
        const navLinks = document.getElementById('navLinks');
        mobileToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            const icon = mobileToggle.querySelector('i');
            icon.classList.toggle('fa-bars');
            icon.classList.toggle('fa-times');
        });

        function setPriceRange(min, max) {
            document.getElementById('min_price').value = min;
            document.getElementById('max_price').value = max;
            searchCars();
        }

        async function searchCars() {
            const minPrice = parseFloat(document.getElementById('min_price').value) || 0;
            const maxPrice = parseFloat(document.getElementById('max_price').value) || 10000000;

            const loadingSection = document.getElementById('loadingSection');
            const resultsSection = document.getElementById('resultsSection');
            const noResults = document.getElementById('noResults');

            loadingSection.style.display = 'flex';
            resultsSection.innerHTML = '';
            noResults.style.display = 'none';

            try {
                const response = await fetch(`/api/recommendations?min_price=${minPrice}&max_price=${maxPrice}`);
                const data = await response.json();

                if (data.success && data.recommendations.length > 0) {
                    resultsSection.innerHTML = data.recommendations.map(car => `
                        <div class="car-card">
                            ${car.is_custom ? '<div style="position:absolute; top:10px; right:10px; background:#28a745; color:white; padding:0.25rem 0.5rem; border-radius:5px; font-size:0.75rem; font-weight:bold;"><i class="fas fa-star"></i> Custom</div>' : ''}
                            <img src="${car.image_url}" alt="${car.company} ${car.model}" class="car-image" onerror="this.src='https://via.placeholder.com/400x300/667eea/ffffff?text=${car.company}+${car.model}'">
                            <div class="car-info">
                                <h3>${car.company} ${car.model}</h3>
                                <div class="car-price">₹${car.price.toLocaleString('en-IN')}</div>
                                <div class="car-details"><i class="fas fa-calendar"></i> ${car.year}</div>
                                <div class="car-details"><i class="fas fa-gas-pump"></i> ${car.fuel_type}</div>
                                <div class="car-details"><i class="fas fa-tachometer-alt"></i> ${car.kms_driven.toLocaleString('en-IN')} km</div>
                                ${car.description ? `<div style="margin-top:0.5rem; font-size:0.9rem; color:#666;">${car.description}</div>` : ''}
                            </div>
                        </div>
                    `).join('');
                } else {
                    noResults.style.display = 'block';
                }
            } catch (error) {
                console.error('Error:', error);
                noResults.style.display = 'block';
            } finally {
                loadingSection.style.display = 'none';
            }
        }

        function toggleAddCarForm() {
            const form = document.getElementById('addCarForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
            if (form.style.display === 'block') {
                form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        async function addCustomCar(event) {
            event.preventDefault();
            const messageDiv = document.getElementById('addCarMessage');
            messageDiv.innerHTML = '<div style="color:#007bff;"><i class="fas fa-spinner fa-spin"></i> Adding car...</div>';

            const carData = {
                company: document.getElementById('custom_company').value.trim(),
                model: document.getElementById('custom_model').value.trim(),
                year: parseInt(document.getElementById('custom_year').value),
                fuel_type: document.getElementById('custom_fuel_type').value.trim(),
                price: parseFloat(document.getElementById('custom_price').value),
                kms_driven: parseInt(document.getElementById('custom_kms_driven').value) || 0,
                image_url: document.getElementById('custom_image_url').value.trim(),
                description: document.getElementById('custom_description').value.trim()
            };

            try {
                const response = await fetch('/api/recommendations/add_custom', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(carData)
                });

                const data = await response.json();

                if (data.success) {
                    messageDiv.innerHTML = '<div style="color:#28a745;"><i class="fas fa-check-circle"></i> Car added successfully! Refreshing results...</div>';
                    // Reset form
                    document.getElementById('customCarForm').reset();
                    // Hide form after 2 seconds
                    setTimeout(() => {
                        toggleAddCarForm();
                        messageDiv.innerHTML = '';
                        // Refresh results
                        searchCars();
                    }, 2000);
                } else {
                    messageDiv.innerHTML = `<div style="color:#dc3545;"><i class="fas fa-exclamation-circle"></i> ${data.error || 'Failed to add car'}</div>`;
                }
            } catch (error) {
                console.error('Error:', error);
                messageDiv.innerHTML = '<div style="color:#dc3545;"><i class="fas fa-exclamation-circle"></i> Network error. Please try again.</div>';
            }
        }

        // Search on page load with default range
        searchCars();
    </script>
</body>
</html>



